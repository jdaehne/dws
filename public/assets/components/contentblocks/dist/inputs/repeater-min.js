!function(m,f){f.fieldTypes.repeater=function(o,n){var c=o.find(".contentblocks-repeater-wrapper"),a=tmpl("contentblocks-repeater-item"),s=n.properties&&n.properties.max_items?n.properties.max_items:0,l=n.properties&&n.properties.min_items?n.properties.min_items:0,t=!n.properties||void 0===n.properties.add_first_item||f.toBoolean(n.properties.add_first_item),d=c.siblings(".contentblocks-field-actions-bottom, .contentblocks-field-actions-top"),r=0;m.each(n.subfields,function(e,t){r+=parseInt(t.parent_properties.width)});var p=100<r?"multirow":"",i={init:function(){if(n.rows&&m.isArray(n.rows)&&0<n.rows.length)m.each(n.rows,function(e,t){i.addRow(t)});else if(1<l)for(var e=0;e<l;e++)this.addRow();else t&&this.addRow();0<l&&l===s&&(o.addClass("contentblocks-repeater-fixed-count"),1==l&&o.addClass("contentblocks-repeater-single-item")),d.on("click",".contentblocks-repeater-add-item",i.addEmptyRow),o.on("click",".contentblocks-repeater-delete-row",i.deleteRow),o.find("> .contentblocks-field-wrap > .contentblocks-field").on("click","> .contentblocks-repeater-expanded",function(){m(this).removeClass("contentblocks-repeater-expanded").addClass("contentblocks-repeater-collapsed").text("+").closest(".contentblocks-field-repeater").children(".contentblocks-repeater-wrapper").slideUp(300,function(){f.fixColumnHeights()})}).on("click","> .contentblocks-repeater-collapsed",function(){m(this).removeClass("contentblocks-repeater-collapsed").addClass("contentblocks-repeater-expanded").text("-").closest(".contentblocks-field-repeater").children(".contentblocks-repeater-wrapper").slideDown(300,function(){f.fixColumnHeights()})}),o.on("click","> .contentblocks-field-wrap > .contentblocks-field > .contentblocks-repeater-wrapper > .contentblocks-repeater-row > .contentblocks-repeater-item-expanded",function(){m(this).removeClass("contentblocks-repeater-item-expanded").addClass("contentblocks-repeater-item-collapsed").text("+").closest(".contentblocks-repeater-row").children(".contentblocks-repeater-item-wrapper").slideUp(300,function(){f.fixColumnHeights()})}).on("click","> .contentblocks-field-wrap > .contentblocks-field > .contentblocks-repeater-wrapper > .contentblocks-repeater-row > .contentblocks-repeater-item-collapsed",function(){m(this).removeClass("contentblocks-repeater-item-collapsed").addClass("contentblocks-repeater-item-expanded").text("-").closest(".contentblocks-repeater-row").children(".contentblocks-repeater-item-wrapper").slideDown(300,function(){f.fixColumnHeights()})}),("0"===s||0===s||1<s)&&c.sortable({items:"> li",forceHelperSize:!0,forcePlaceholderSize:!0,placeholder:"ui-sortable-placeholder",tolerance:"pointer",cursor:"move",cancel:"input,textarea,button,select,option,.prevent-drag",update:function(e,t){t.item.trigger("contentblocks:field_dragged"),f.fixColumnHeights(),f.fireChange()},start:function(e,t){if(t.placeholder.height(t.item.height()),window.CKEDITOR){var o=t.item.find(".cke");if(0<o.length){var n=o.attr("id").replace("cke_","");console.log(n,CKEDITOR.instances[n]),CKEDITOR.instances[n]&&(t.item.data("ckeditor-id",n),t.item.data("ckeditor-config",CKEDITOR.instances[n].config),CKEDITOR.instances[n].destroy(),CKEDITOR.remove(n))}}},stop:function(e,t){if(window.tinymce){var o=t.item.find(".mceEditor");if(0<o.length){var n=m(o[0]).attr("id").replace("textarea_parent","textarea");tinymce.execCommand("mceRemoveControl",!0,n),tinymce.execCommand("mceAddControl",!0,n)}var r=t.item.find(".mce-tinymce");if(0<r.length){var i=r.siblings("textarea").attr("id");tinymce.execCommand("mceRemoveEditor",!0,i),tinymce.execCommand("mceAddEditor",!0,i)}}if(window.CKEDITOR){var c=t.item.data("ckeditor-id"),a=t.item.data("ckeditor-config");c&&CKEDITOR.replace(c,a)}}})},deleteRow:function(){var e=c.children().length;l<e&&(m(this).closest(".contentblocks-repeater-row").remove(),e--),0<s&&e==s-1&&d.find(".contentblocks-repeater-add-item").show(),f.fixColumnHeights()},addEmptyRow:function(){if(0<s){var e=c.children().length;if(s<=e)return void f.alert(_("contentblocks.repeater.max_items_reached",{max:s}))}i.addRow({},m(this).data("target"))},addRow:function(r,e){r=r||{};var i=m(a({})).addClass(p);e&&"bottom"!=e?c.prepend(i):c.append(i),m.each(n.subfields,function(e,t){var o=m.extend(!0,{},t);r[t.parent_properties.key]&&(o=m.extend(!0,{},o,r[t.parent_properties.key]));var n=f.addField(i.children("ul"),t.id,o,"bottom");0<o.parent_properties.width&&n.css("width",o.parent_properties.width+"%"),n.data("repeater-key",o.parent_properties.key)});var t=c.children().length;0<s&&t==s&&d.find(".contentblocks-repeater-add-item").hide(),0<l&&l<t&&o.find(".contentblocks-repeater-delete-row").show(),f.fixColumnHeights()},getData:function(){var o=[];return c.children(".contentblocks-repeater-row").each(function(e,t){var c={};(t=m(t)).children("ul").children("li").each(function(e,t){var o=(t=m(t)).attr("id"),n=f.generatedContentFields[o],r=t.data("repeater-key");if(n){var i=n.getData();i.fieldId=o,c[r]=i}else console&&console.error("input not found with id",o)}),o.push(c)}),{rows:o}}};return i}}(vcJquery,ContentBlocks);
//# sourceMappingURL=repeater-min.js.map