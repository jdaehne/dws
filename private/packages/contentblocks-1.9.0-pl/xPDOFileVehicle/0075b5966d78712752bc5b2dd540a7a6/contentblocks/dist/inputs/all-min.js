!function(s,l){l.fieldTypes.heading=function(o,r){var i={init:function(){var e=r.properties.available_levels||"h1=heading_1,h2=heading_2,h3=heading_3,h4=heading_4,h5=heading_5,h6=heading_6",i=o.find(".contentblocks-field-heading-level select");if(e=e.split(","),s.each(e,function(e,t){t=t.split("=");var n=_("contentblocks."+t[1])||t[1];i.append('<option value="'+t[0]+'">'+n+"</option>")}),r.level)i.val(r.level);else{var t=r.properties.default_level||"h2";i.val(t)}if(l.toBoolean(r.properties.use_tinyrte)){var n=o.find("#"+r.generated_id+"_input");l.addTinyRte(n)}},getData:function(){return{value:o.find(".contentblocks-field-heading-input input").val(),level:o.find(".contentblocks-field-heading-level select").val()}},confirmBeforeDelete:function(){var e=i.getData(),t=e.level!=r.properties.default_level,n=0<e.value.replace(/^\s\s*/,"").replace(/\s\s*$/,"").length;return t||n}};return i},l.fieldTypes.textarea=function(t,n){return{init:function(){if(n.properties&&l.toBoolean(n.properties.use_tinyrte)){var e=t.find("#"+n.generated_id+"_textarea");l.addTinyRte(e)}else setTimeout(function(){t.find(".contentblocks-field-textarea textarea").autoGrow().on("change",l.fixColumnHeights)},100)},getData:function(){return{value:t.find(".contentblocks-field-textarea textarea").val()}}}},l.fieldTypes.richtext=function(t,e){return{init:function(){var e=t.find(".contentblocks-field-textarea textarea");MODx.loadRTE?(MODx.loadRTE(e.attr("id")),setTimeout(function(){l.fixColumnHeights()},100)):setTimeout(function(){e.autoGrow()},100),e.on("change",l.fixColumnHeights)},getData:function(){return{value:t.find(".contentblocks-field-textarea textarea").val()}}}},l.fieldTypes.textfield=function(t,n){return{init:function(){if(l.toBoolean(n.properties.use_tinyrte)){var e=t.find("#"+n.generated_id+"_textfield");l.addTinyRte(e)}},getData:function(){return{value:t.find(".contentblocks-field-text input").val()}}}},l.fieldTypes.quote=function(t,n){return{init:function(){if(l.toBoolean(n.properties.use_tinyrte)){var e=t.find("#"+n.generated_id+"_quote");l.addTinyRte(e)}else setTimeout(function(){t.find(".contentblocks-field-textarea textarea").autoGrow().on("change",l.fixColumnHeights)},100);n.cite&&t.find(".contentblocks-field-text input").val(n.cite)},getData:function(){return{value:t.find(".contentblocks-field-textarea textarea").val(),cite:t.find(".contentblocks-field-text input").val()}}}}}(vcJquery,ContentBlocks),function(e,i){i.fieldTypes.link=function(t,e){var n={init:function(){i.initializeLinkField(t.find("input[id].linkfield"),e)},getData:function(){var e=t.find("input[id].linkfield");return{link:e.val(),linkType:i.getLinkFieldDataType(e.val())}}};return n}}(vcJquery,ContentBlocks),function(e,o){o.fieldTypes.table=function(t,n){var i={table:!1,handsontable:!1,init:function(){this.table=t.find(".contentblocks-field-table-instance");var e={startRows:3,minSpareRows:1,minSpareCols:1,startCols:4,stretchH:"all",manualColumnMove:!0,enterBeginsEditing:!1,contextMenu:!0,autoWrapCol:!0,nativeScrollbars:!1,afterChange:function(){o.fireChange()},afterCreateRow:o.fixColumnHeights,afterRemoveRow:o.fixColumnHeights};n.value&&(e.data=n.value),this.table.handsontable(e),this.handsontable=this.table.handsontable("getInstance"),t.on("contentblocks:field_dragged",function(){i.handsontable.render()})},getData:function(){return{value:this.handsontable.getData()}}};return i}}(vcJquery,ContentBlocks),vcJquery,ContentBlocks.fieldTypes.hr=function(e,t){var n={getData:function(){return{value:1}}};return n},function(o,l){l.fieldTypes.image=function(r,i){var s={fieldDom:r.find(".contentblocks-field"),fileBrowser:!1,source:0<i.properties.source?i.properties.source:ContentBlocksConfig["image.source"],directory:i.properties.directory,cropData:i.crops||{},cropPreviews:r.find(".contentblocks-field-image-crop-previews"),openCropperAutomatically:l.toBoolean(i.properties.open_crops_automatically),init:function(){if(i.url&&i.url.length){var e=l.utilities.normaliseUrls(i.url);r.find(".url").val(e.cleanedSrc).change(),r.find(".size").val(i.size),r.find(".width").val(i.width),r.find(".height").val(i.height),r.find(".extension").val(i.extension),r.find("img.contentblocks-field-image-preview-img").attr("src",s.getThumbnailPreview(i.url)),s.fieldDom.addClass("preview"),s.initCropPreviews()}i.properties.crops&&0!==i.properties.crops.length?(r.find(".contentblocks-field-crop-image").on("click",s.openCropper),r.on("click",".contentblocks-field-image-crop-preview",function(e){var t=o(this).data("key");s.openCropper(e,t)})):r.find(".contentblocks-field-crop-image").hide(),r.find(".contentblocks-field-delete-image").on("click",function(){s.fieldDom.removeClass("preview"),r.find(".url").val("").change(),r.find(".size").val(""),r.find(".width").val(""),r.find(".height").val(""),r.find(".extension").val(""),r.find("img.contentblocks-field-image-preview-img").attr("src",""),s.cropData=i.crops={},s.cropPreviews.empty(),l.fixColumnHeights(),l.fireChange()}),r.find(".contentblocks-field-upload").on("click",function(){r.find(".contentblocks-field-upload-field").click()}),r.find(".contentblocks-field-image-choose").on("click",o.proxy(function(){this.chooseImage()},this)),r.find(".contentblocks-field-image-url").on("click",o.proxy(function(){this.promptImage()},this)),this.initUpload(),this.initDropReceiver()},getThumbnailPreview:function(e){return i.properties.thumbnail_crop&&s.cropData[i.properties.thumbnail_crop]&&s.cropData[i.properties.thumbnail_crop].url?s.cropData[i.properties.thumbnail_crop].url:i.properties.thumbnail_size?l.utilities.getThumbnailUrl(e,i.properties.thumbnail_size):l.utilities.normaliseUrls(e).displaySrc},initDropReceiver:function(){MODx.load({xtype:"modx-treedrop",target:r,targetEl:r.get(0),onInsert:function(e){s.insertFromUrl(e)}})},initUpload:function(){var e=r.attr("id");r.find("#"+e+"-upload").fileupload({url:ContentBlocksConfig.connectorUrl+"?action=content/image/upload",dataType:"json",dropZone:r,progressInterval:250,paramName:"file",pasteZone:null,add:function(e,t){if(l.fireChange(),r.addClass("uploading"),t.files[0].ext=t.files[0].name.split(".").pop(),t.files[0].size<7e5&&window.FileReader){var n=new FileReader;n.onload=function(e){r.find("img.contentblocks-field-image-preview-img").attr("src",e.target.result),l.fixColumnHeights()},n.readAsDataURL(t.files[0])}setTimeout(function(){t.submit()},1e3)},done:function(e,t){if(t.result.success){var n=t.result.object,i=l.utilities.normaliseUrls(n.url);r.find(".url").val(i.cleanedSrc).change(),r.find(".size").val(n.size),r.find(".width").val(n.width),r.find(".height").val(n.height),r.find(".extension").val(n.extension),r.find("img.contentblocks-field-image-preview-img").attr("src",s.getThumbnailPreview(n.url)),s.fieldDom.addClass("preview"),s.loadTinyRTE(),s.openCropperAutomatically&&s.openCropper()}else{var o=_("contentblocks.upload_error",{file:t.files[0].filename,message:t.result.message});1572864<t.files[0].size&&(o+=_("contentblocks.upload_error.file_too_big")),l.alert(o),r.find("img.contentblocks-field-image-preview-img").attr("src","")}r.removeClass("uploading"),setTimeout(function(){l.fixColumnHeights(r.parents(".contentblocks-region-content"))},150)},fail:function(e,t){var n=_("contentblocks.upload_error",{file:t.files[0].filename,message:t.result.message});1572864<t.files[0].size&&(n+=_("contentblocks.upload_error.file_too_big")),l.alert(n),r.removeClass("uploading"),r.find("img.contentblocks-field-image-preview-img").attr("src",""),l.fixColumnHeights(r.parents(".contentblocks-region-content"))},formData:function(){var e=[{name:"HTTP_MODAUTH",value:MODx.siteId},{name:"resource",value:MODx.request.id||0},{name:"field",value:i.id}];return i.settingKey&&e.push({name:"setting_key",value:i.settingKey}),i.layout&&e.push({name:"layout",value:i.layout}),e},progress:function(e,t){var n=parseInt(t.loaded/t.total*100,10)+"%";r.find(".upload-progress .bar").width(n)}})},chooseImage:function(){var e=MODx.load({xtype:"modx-browser",id:Ext.id(),multiple:!0,listeners:{select:function(e){s.chooseImageCallback(e)}},allowedFileTypes:i.properties.file_types,hideFiles:!0,title:_("contentblocks.choose_image"),source:s.source,openTo:i.properties.directory});e.setSource(s.source),e.show(),e.win.setZIndex(10210)},chooseImageCallback:function(e){var t=e.fullRelativeUrl;"http"!=t.substr(0,4)&&"/"!=t.substr(0,1)&&(t=MODx.config.base_url+t);var n=l.utilities.normaliseUrls(t);r.find(".url").val(n.cleanedSrc).change(),r.find(".size").val(e.size),r.find(".width").val(e.image_width),r.find(".height").val(e.image_height),r.find(".extension").val(e.ext),r.find("img.contentblocks-field-image-preview-img").attr("src",s.getThumbnailPreview(t)),s.fieldDom.addClass("preview"),l.fireChange(),this.loadTinyRTE(),s.openCropperAutomatically&&s.openCropper()},promptImage:function(){Ext.Msg.prompt(_("contentblocks.from_url_title"),_("contentblocks.from_url_prompt"),function(e,t,n){"ok"===e&&s.insertFromUrl(t)},this)},insertFromUrl:function(e){!e||e.length<3?l.alert("No URL provided."):(r.addClass("contentblocks-field-loading"),o.ajax({dataType:"json",url:ContentBlocksConfig.connector_url,type:"POST",beforeSend:function(e,t){t.crossDomain||e.setRequestHeader("modAuth",MODx.siteId)},data:{action:"content/image/download",field:i.field,layout:i.layout,setting_key:i.settingKey,resource:ContentBlocksResource&&ContentBlocksResource.id?ContentBlocksResource.id:0,url:e},context:this,success:function(e){if(r.removeClass("contentblocks-field-loading"),e.success){var t=l.utilities.normaliseUrls(e.object.url);r.find(".url").val(t.cleanedSrc).change(),r.find(".size").val(e.object.size),r.find(".width").val(e.object.width),r.find(".height").val(e.object.height),r.find(".extension").val(e.object.extension),r.find("img.contentblocks-field-image-preview-img").attr("src",s.getThumbnailPreview(t.cleanedSrc)),s.fieldDom.addClass("preview"),l.fireChange(),this.loadTinyRTE(),s.openCropperAutomatically&&s.openCropper()}else l.alert(e.message)}}))},initCropPreviews:function(){o.each(s.cropData,function(e,t){if(t.url&&i.properties.crops&&-1!==i.properties.crops.indexOf(e)){var n=o.extend({cropKey:e},t);s.cropPreviews.append(tmpl("contentblocks-field-image-crop",n))}})},openCropper:function(e,t){var n=o.extend(!0,{},i,s.getData());console.log(n),t=t||!1,l.Cropper(n,{configurations:i.properties.crops||"",initialCrop:t}).onChange(function(e){s.cropData=o.extend(!0,{},e,!0),o.each(e,function(e,t){if(t.url){var n=s.cropPreviews.find(".image-crop-"+e+" img");if(n&&n.length)n.attr("src",t.url);else{var i=o.extend({cropKey:e},t);s.cropPreviews.append(tmpl("contentblocks-field-image-crop",i))}}}),i.properties.thumbnail_crop&&s.cropData[i.properties.thumbnail_crop]&&s.cropData[i.properties.thumbnail_crop].url&&r.find("img.contentblocks-field-image-preview-img").attr("src",s.cropData[i.properties.thumbnail_crop].url)})},getData:function(){return{url:r.find(".url").val(),size:r.find(".size").val(),width:r.find(".width").val(),height:r.find(".height").val(),extension:r.find(".extension").val(),crops:s.cropData||{}}},loadTinyRTE:function(){}};return s},l.fieldTypes.image_with_title=function(t,n){var i=l.fieldTypes.image(t,n);return i.init=function(){if(n.url&&n.url.length){var e=l.utilities.normaliseUrls(n.url);t.find(".url").val(e.cleanedSrc).change(),t.find(".size").val(n.size),t.find(".width").val(n.width),t.find(".height").val(n.height),t.find(".extension").val(n.extension),t.find("img.contentblocks-field-image-preview-img").attr("src",i.getThumbnailPreview(n.url)),t.find(".contentblocks-field-image-title-input").val(n.title||""),i.fieldDom.addClass("preview"),i.initCropPreviews(),this.loadTinyRTE()}n.properties.crops&&0!==n.properties.crops.length?(t.find(".contentblocks-field-crop-image").on("click",i.openCropper),t.on("click",".contentblocks-field-image-crop-preview",function(e){var t=o(this).data("key");i.openCropper(e,t)})):t.find(".contentblocks-field-crop-image").hide(),t.find(".contentblocks-field-delete-image").on("click",function(){i.fieldDom.removeClass("preview"),t.find(".url").val("").change(),t.find(".size").val(""),t.find(".width").val(""),t.find(".height").val(""),t.find(".extension").val(""),t.find(".contentblocks-field-image-title-input").val("").removeClass("tinyrte-replaced"),t.find("img.contentblocks-field-image-preview-img").attr("src",""),t.find(".tinyrte-container").remove(),i.cropData=n.crops={},i.cropPreviews.empty(),l.fixColumnHeights(),l.fireChange()}),t.find(".contentblocks-field-upload").on("click",function(){t.find(".contentblocks-field-upload-field").click()}),t.find(".contentblocks-field-image-choose").on("click",o.proxy(function(){this.chooseImage()},this)),t.find(".contentblocks-field-image-url").on("click",o.proxy(function(){this.promptImage()},this)),this.initUpload(),this.initDropReceiver()},i.loadTinyRTE=function(){if(l.toBoolean(n.properties.use_tinyrte)){var e=t.find(".contentblocks-field-image-title-input");l.addTinyRte(e)}},i.getData=function(){return{url:t.find(".url").val(),title:t.find(".contentblocks-field-image-title-input").val(),size:t.find(".size").val(),width:t.find(".width").val(),height:t.find(".height").val(),extension:t.find(".extension").val(),crops:i.cropData||{}}},i}}(vcJquery,ContentBlocks),function(a,c){c.fieldTypes.file=function(s,i){var l={fileCount:0,fileBrowser:!1,source:0<i.properties.source?i.properties.source:ContentBlocksConfig["image.source"],directory:i.properties.directory,init:function(){this.initUpload(),s.find(".contentblocks-field-upload").on("click",function(){s.find(".contentblocks-field-upload-field").click()}),s.find(".contentblocks-field-file-choose").on("click",a.proxy(function(){this.chooseFile()},this)),a.isArray(i.files)&&a.each(i.files,function(e,t){l.fileCount++,t.id=i.generated_id+"-file"+l.fileCount,l.addFile(t)}),s.find(".file-holder").sortable({connectWith:".file-holder",forceHelperSize:!0,forcePlaceholderSize:!0,placeholder:"contentblocks-file-placeholder",tolerance:"pointer",cursor:"move",update:function(){c.fixColumnHeights(),MODx.fireResourceFormChange()},start:function(e,t){t.placeholder.height(t.item.height())}})},chooseFile:function(){var e=i.properties.max_files,t=s.find(".file-holder").find("li").length;if(0<e&&e<=t)return alert(_("contentblocks.file.max_files.reached",{max:e})),!1;var n=MODx.load({xtype:"modx-browser",id:Ext.id(),multiple:!0,listeners:{select:function(e){l.chooseFileCallback(e)}},allowedFileTypes:i.properties.file_types,hideFiles:!0,title:_("contentblocks.file.choose_file"),source:l.source,openTo:i.properties.directory});n.setSource(l.source),n.show()},chooseFileCallback:function(e){var t=e.fullRelativeUrl;"http"!=t.substr(0,4)&&"/"!=t.substr(0,1)&&(t=MODx.config.base_url+t),l.fileCount++;var n=s.attr("id")+"-file"+l.fileCount,i=e.size,o=Math.round(Date.parse(e.lastmod)/1e3),r=e.ext;this.addFile({url:t,title:e.filename,id:n,size:i,upload_date:o,extension:r})},addFile:function(e){var t=e.url||e.title,n=s.find(".file-holder");e.filename=t.split("/").pop(),e.icon=l.getIconClass(e.extension),n.append(tmpl("contentblocks-field-fileinput_file",e));var i=a("#"+e.id);i.find(".contentblocks-fileinput_file-delete").on("click",function(){i.fadeOut(function(){i.remove(),c.fixColumnHeights(),MODx.fireResourceFormChange()})})},getIconClass:function(e){switch(e){case"doc":case"docx":case"pages":case"odt":case"rtf":case"tex":case"wpd":case"wps":return"word";case"txt":case"msg":case"log":case"dat":case"sdf":return"text";case"pps":case"ppt":case"pptx":case"key":return"powerpoint";case"csv":case"xlr":case"xls":case"xlsx":return"excel";case"pdf":case"indd":return"pdf";case"aif":case"iff":case"m3u":case"m4a":case"mid":case"mp3":case"mpa":case"ra":case"wav":case"wma":return"audio";case"3g2":case"3gp":case"asf":case"asx":case"avi":case"flv":case"m4v":case"mov":case"mp4":case"mpg":case"rm":case"swf":case"vob":case"wmv":return"video";case"bmp":case"dds":case"gif":case"jpg":case"jpeg":case"png":case"psd":case"pspimage":case"tga":case"thm":case"tif":case"tiff":case"yuv":case"ai":case"eps":case"ps":case"svg":return"image";case"7z":case"cbr":case"deb":case"gz":case"pkg":case"rar":case"rpm":case"sitx":case"tar":case"zip":case"zipx":return"zip";default:return e}},initUpload:function(){var o=s.attr("id"),r=i.properties.max_files;s.find("#"+o+"-upload").fileupload({url:ContentBlocksConfig.connectorUrl+"?action=content/file/upload",dataType:"json",dropZone:a("#"+o),progressInterval:250,paramName:"file",multiple:!0,pasteZone:null,add:function(e,t){var n=s.find(".file-holder").find("li").length;if(0<r&&r<=n)return alert(_("contentblocks.file.max_files.reached",{max:r})),!1;l.fileCount++;var i=o+"-file"+l.fileCount;t.files[0].ext=t.files[0].name.split(".").pop(),l.addFile({title:t.files[0].name,url:"",id:i,size:t.files[0].size,upload_date:t.files[0].upload_date,extension:t.files[0].ext}),t.domId="#"+i,a(t.domId).addClass("uploading"),setTimeout(function(){t.submit()},1e3),MODx.fireResourceFormChange()},done:function(e,t){var n=a(t.domId);if(t.result.success){var i=t.result.object;n.find(".url").val(i.url),n.find(".size").val(i.size),n.find(".upload_date").val(i.upload_date),n.find(".extension").val(i.extension),n.removeClass("uploading")}else{var o=_("contentblocks.upload_error",{file:t.files[0].filename,message:t.result.message});t.files[0].size>MODx.config.upload_maxsize&&(o+=_("contentblocks.upload_error.file_too_big")),alert(o),n.remove()}setTimeout(function(){c.fixColumnHeights()},150)},fail:function(e,t){var n=_("contentblocks.upload_error",{file:t.files[0].filename,message:t.result.message});t.files[0].size>MODx.config.upload_maxsize&&(n+=_("contentblocks.upload_error.file_too_big")),alert(n),a(t.domId).remove(),c.fixColumnHeights()},formData:function(){return[{name:"HTTP_MODAUTH",value:MODx.siteId},{name:"resource",value:MODx.request.id||0},{name:"field",value:i.id}]},progress:function(e,t){var n=parseInt(t.loaded/t.total*100,10)+"%";a(t.domId).find(".upload-progress .bar").width(n)}}).on("fileuploaddragover",function(){a(this).css("background","red")})},getData:function(){var o=[];return s.find(".file-holder li").each(function(e,t){var n=a(t),i={url:n.find(".url").val(),title:n.find(".title").val(),size:n.find(".size").val(),upload_date:n.find(".upload_date").val(),extension:n.find(".extension").val()};o.push(i)}),{files:o}}};return l}}(vcJquery,ContentBlocks),function(s,l){l.fieldTypes.chunk=function(i,o){var r={preview:i.find(".chunkOutput"),propList:i.find(".contentblocks-properties-list"),dynamicPreview:!0,fieldWrapper:i.closest(".contentblocks-field-outer"),init:function(){if(!o.properties||!o.properties.chunk||o.properties.chunk<1)r.preview.html("<p>"+_("contentblocks.chunk.no_chunk_set")+"</p>");else{if(o.properties.custom_preview&&1<o.properties.custom_preview.length)r.dynamicPreview=!1,r.preview.html(o.properties.custom_preview);else{i.addClass("contentblocks-field-loading");var e=window.Ext&&Ext.getCmp?Ext.getCmp("modx-panel-resource"):null;e&&e.on("success",function(e){r.loadPreview(!1,r.getPreviewData())})}r.fieldWrapper.on("input change","input, textarea, select",l.utilities.debounce(function(){l.fireChange(),r.dynamicPreview&&r.loadPreview(!1,r.getPreviewData())},300)),r.loadPreview(!0,r.getPreviewData(!0))}},getPreviewData:function(e){e=e||!1;var t=s.extend({settings:Ext.decode(r.fieldWrapper.data("settings"))||{}},r.getData());return e&&(t.chunk_properties=o.chunk_properties),t},loadPreview:function(n,e){s.ajax({dataType:"json",url:ContentBlocksConfig.connector_url,type:"POST",beforeSend:function(e,t){t.crossDomain||e.setRequestHeader("modAuth",MODx.siteId)},data:{action:"content/chunk/get",id:o.properties.chunk,field:o.field,resource:ContentBlocksResource&&ContentBlocksResource.id?ContentBlocksResource.id:0,data:e},context:this,success:function(e){if(e.success){if(r.dynamicPreview){var t=e.object.preview;t=t.replace(/(<\s*\/?\s*)script(\s*([^>]*)?\s*>)/gi,"$1jscript$2"),i.find(".chunkOutput").html(t)}n&&e.object.properties&&this.loadProperties(e.object.properties)}else r.preview.html(e.message),l.alert(e.message);i.removeClass("contentblocks-field-loading")}})},getData:function(){var o={};return r.propList.find("li").each(function(e,t){var n=s(t).find("input,select"),i=n.data("name");o[i]=n.val()}),{chunk_properties:o}},loadProperties:function(e){r.propList.empty().hide(),e&&(s.each(e,function(e,t){var n=o.chunk_properties&&o.chunk_properties[e]?o.chunk_properties[e]:t.value;t.id="contentblocks-chunk-property-"+e+"-"+o.generated_id,t.key=e,t.value=n,t.name=_(t.name)?_(t.name):t.name,t.type,r.propList.append(tmpl("contentblocks-field-chunk-property",t))}),r.propList.show(),l.fixColumnHeights())}};return r}}(vcJquery,ContentBlocks),function(o,r){r.fieldTypes.dropdown=function(t,n){var i={fieldId:n.field,select:null,options:{},init:function(){if(t.addClass("contentblocks-field-loading"),this.select=t.find(".contentblocks-field-dropdown-select select"),n.value){var e=o("<option></option>");e.attr("value",n.value),e.text(n.display?n.display:n.value),this.select.append(e),this.select.attr("disabled","disabled")}o.ajax({dataType:"json",url:ContentBlocksConfig.connectorUrl,data:{action:"content/dropdown/getlist",field:i.fieldId,resource:MODx.request.id||0},context:this,beforeSend:function(e,t){t.crossDomain||e.setRequestHeader("modAuth",MODx.siteId)},success:function(e){e.results?(i.setOptions(e.results),this.optionsLoaded()):r.alert(_("contentblocks.dropdown.none_available")),t.removeClass("contentblocks-field-loading")}})},setOptions:function(e){i.options=e,i.optionsLoaded()},optionsLoaded:function(){i.select.empty(),o.each(i.options,function(e,t){var n=o("<option></option>");n.attr("value",t.value),n.text(t.display),t.disabled&&n.attr("disabled","disabled"),i.select.append(n)}),n.value||(n.value=n.properties.default_value),n.value&&i.select.val(n.value),i.select.attr("disabled",null)},getData:function(){return{value:i.select.val()||"",display:i.select.find(":selected").text()}}};return i}}(vcJquery,ContentBlocks),function(s,l){l.fieldTypes.snippet=function(t,n){var r={fieldId:n.field,propertyId:0,snippet:"",snippets:{},properties:{},hiddenProperties:{},select:null,propertiesList:null,propertiesSelectWrapper:null,propertiesSelect:null,init:function(){l.toBoolean(n.properties.allow_uncached)?t.find(".uncached").val(n.uncached||""):t.find(".contentblocks-field-snippet-uncached").hide(),t.addClass("contentblocks-field-loading"),this.select=t.find(".contentblocks-field-snippet-select select"),this.propertiesList=t.find(".contentblocks-properties-list"),this.propertiesSelectWrapper=t.find(".contentblocks-field-snippet-add-property"),this.propertiesSelect=this.propertiesSelectWrapper.find("select"),this.select.on("change",s.proxy(function(){this.chooseSnippet(this.select.val())},this)),this.propertiesSelect.on("change",s.proxy(function(){this.chooseProperty(this.propertiesSelect.val())},this)),s.ajax({dataType:"json",url:ContentBlocksConfig.connectorUrl,data:{action:"content/snippet/getlist",field:r.fieldId},context:this,beforeSend:function(e,t){t.crossDomain||e.setRequestHeader("modAuth",MODx.siteId)},success:function(e){e.results?e.results&&e.results.length?(s.each(e.results,function(e,t){r.snippets[t.name]=t}),this.snippetsLoaded()):l.alert(_("contentblocks.snippet.none_available")):l.alert(e.message),t.removeClass("contentblocks-field-loading")}})},snippetsLoaded:function(){if(r.select.empty(),r.select.append("<option></option>"),s.each(r.snippets,function(e,t){r.select.append('<option value="'+e+'">'+t.name+"</option>")}),!n.snippet||!n.snippet.length&&1==r.snippets.length){for(var e in r.snippets)break;n.snippet=e}n.snippet&&(r.select.val(n.snippet),r.chooseSnippet(n.snippet),n.snippet_properties&&s.each(n.snippet_properties,function(e,t){r.chooseProperty(e,t)})),r.select.find("option").length<2?r.select.hide():r.select.show()},chooseSnippet:function(e){var t=this.snippets[e];if(!t)return console&&console.error("Snippet "+e+" not found in available snippets: ",this.snippets),!1;r.snippet=e,r.properties=t.properties,r.propertiesSelect.empty(),r.propertiesList.empty(),r.propertiesSelect.append("<option></option>"),t.properties&&s.each(t.properties,function(e,t){r.propertiesSelect.append('<option value="'+e+'">'+t.name+"</option>")}),r.propertiesSelect.append('<option value="__other__">'+_("contentblocks.snippet.other_property")+"</option>"),r.propertiesSelectWrapper.show()},chooseProperty:function(e,t){t=t||"",r.propertyId++;var n=!1;if(n="__other__"==e?{name:_("contentblocks.snippet.other_property"),desc_trans:_("contentblocks.snippet.other_property.desc")}:!(!r.properties||!r.properties[e])&&r.properties[e]){n.id="contentblocks-snippet-property-"+r.propertyId,n.key=e,n.value=t,r.propertiesSelect.find("option[value="+e+"]").remove(),r.hiddenProperties[e]=n,r.propertiesList.append(tmpl("contentblocks-field-snippet-property",n));var i=r.propertiesList.find("#"+n.id);i.find(".contentblocks-field-snippet-delete-property").on("click",function(){r.propertiesSelect.append('<option value="'+e+'">'+n.name+"</option>"),r.hiddenProperties[e]=!1,i.remove(),r.propertiesList.find("li").length<1&&r.propertiesList.hide()}),i.find("input").on("keyup",function(){l.fireChange()}),r.propertiesList.show()}else console&&console.error("Property "+e+" not found for snippet "+r.snippet)},getData:function(){var o={};r.propertiesList.find("li").each(function(e,t){var n=s(t).find("input"),i=n.data("name");o[i]=n.val()});var e=l.toBoolean(n.properties.allow_uncached)?t.find(".uncached").val():"0";return{snippet:r.snippet,snippet_properties:o,uncached:e}}};return r}}(vcJquery,ContentBlocks),function(s,o){o.fieldTypes.chunk_selector=function(t,n){var r={fieldId:n.field,propertyId:0,chunk_selector:"",chunk_selectors:{},properties:{},hiddenProperties:{},select:null,propertiesList:null,propertiesSelectWrapper:null,propertiesSelect:null,init:function(){t.addClass("contentblocks-field-loading"),this.select=t.find(".contentblocks-field-chunk_selector-select select"),this.propertiesList=t.find(".contentblocks-properties-list"),this.propertiesSelectWrapper=t.find(".contentblocks-field-chunk_selector-add-property"),this.propertiesSelect=this.propertiesSelectWrapper.find("select"),this.select.on("change",s.proxy(function(){this.chooseChunk(this.select.val())},this)),this.propertiesSelect.on("change",s.proxy(function(){this.chooseProperty(this.propertiesSelect.val())},this)),s.ajax({dataType:"json",url:ContentBlocksConfig.connectorUrl,data:{action:"content/chunk_selector/getlist",field:r.fieldId},context:this,beforeSend:function(e,t){t.crossDomain||e.setRequestHeader("modAuth",MODx.siteId)},success:function(e){e.results?e.results&&e.results.length?(s.each(e.results,function(e,t){r.chunk_selectors[t.name]=t}),this.chunk_selectorsLoaded()):o.alert(_("contentblocks.snippet.none_available")):o.alert(e.message),t.removeClass("contentblocks-field-loading")}})},chunk_selectorsLoaded:function(){if(r.select.empty(),r.select.append("<option></option>"),s.each(r.chunk_selectors,function(e,t){t.name=""!=t.description?t.name+" ("+t.description+")":t.name,r.select.append('<option value="'+e+'">'+t.name+"</option>")}),!n.chunk_selector||!n.chunk_selector.length&&1==r.chunk_selectors.length){for(var e in r.chunk_selectors)break;n.chunk_selector=e}n.chunk_selector&&(r.select.val(n.chunk_selector),r.chooseChunk(n.chunk_selector),n.chunk_selector_properties&&s.each(n.chunk_selector_properties,function(e,t){r.chooseProperty(e,t)})),r.select.find("option").length<2?r.select.hide():r.select.show()},chooseChunk:function(e){var t=this.chunk_selectors[e];if(!t)return console&&console.error("Chunk "+e+" not found in available chunks: ",this.chunk_selectors),!1;r.chunk_selector=e,r.properties=t.properties,r.propertiesSelect.empty(),r.propertiesList.empty(),r.propertiesSelect.append("<option></option>"),t.properties&&s.each(t.properties,function(e,t){r.propertiesSelect.append('<option value="'+e+'">'+t.name+"</option>")}),r.propertiesSelect.append('<option value="__other__">'+_("contentblocks.snippet.other_property")+"</option>"),r.propertiesSelectWrapper.show()},chooseProperty:function(e,t){t=t||"",r.propertyId++;var n=!1;if(n="__other__"==e?{name:_("contentblocks.snippet.other_property"),desc_trans:_("contentblocks.snippet.other_property.desc")}:!(!r.properties||!r.properties[e])&&r.properties[e]){n.id="contentblocks-chunk_selector-property-"+r.propertyId,n.key=e,n.value=t,n.name=_(n.name)?_(n.name):n.name,r.propertiesSelect.find("option[value="+e+"]").remove(),r.hiddenProperties[e]=n,r.propertiesList.append(tmpl("contentblocks-field-chunk_selector-property",n));var i=r.propertiesList.find("#"+n.id);i.find(".contentblocks-field-chunk-delete-property").on("click",function(){r.propertiesSelect.append('<option value="'+e+'">'+n.name+"</option>"),r.hiddenProperties[e]=!1,i.remove(),r.propertiesList.find("li").length<1&&r.propertiesList.hide()}),i.find("input").on("keyup",function(){o.fireChange()}),r.propertiesList.show()}else console&&console.error("Property "+e+" not found for chunk_selector "+r.chunk_selector)},getData:function(){var o={};return r.propertiesList.find("li").each(function(e,t){var n=s(t).find("input"),i=n.data("name");o[i]=n.val()}),{chunk_selector:r.chunk_selector,chunk_selector_properties:o}}};return r}}(vcJquery,ContentBlocks),function(p,d){d.fieldTypes.layout=function(n,i){var e={init:function(){var e=i.child_layouts||{},t=!1;(i.properties.available_layouts&&n.data("layouts",i.properties.available_layouts),i.properties.available_templates&&n.data("templates",i.properties.available_templates),void 0!==window.event)&&(t=p(window.event.target).hasClass("contentblocks-repeat-layout"));!t&&p.isEmptyObject(e)&&d.initialized&&setTimeout(function(){n.find(".contentblocks-add-layout").click()},500),d.buildContents(e,n.find(".contentblocks-layout-wrapper").first())},destroy:function(){n.find(".contentblocks-layout").each(function(e,t){var n=p(t),i=n.find(".contentblocks-content").not(n.find(".contentblocks-layout .contentblocks-content"));p.each(i,function(e,t){p.each(p(t).find(".contentblocks-field").not(p(t).find(".contentblocks-field .contentblocks-field")),function(e,t){d.deleteField(window.event,p(t),!0)})}),d.deleteLayout(window.event,n,!0)})},getData:function(){var c=[];return n.find(".contentblocks-layout-wrapper").first().children(".contentblocks-layout").each(function(e,t){var n=p(t),i=n.data("layout"),o=p(this).parent().closest("li.contentblocks-field-outer").data("field")||0,r={layout:i,content:{},settings:Ext.decode(n.data("settings"))||{},parent:o},s=n.find("> .contentblocks-region-container > .contentblocks-region-container-header .contentblocks-layout-title").text(),l=ContentBlocksLayouts["_"+i]?ContentBlocksLayouts["_"+i].name:"";_(l)&&(l=_(l)),s&&s.length&&s!==l&&(r.title=s);var a=n.find(".contentblocks-content").not(n.find(".contentblocks-content .contentblocks-content"));p.each(a,function(e,t){var n=p(t),i=n.data("part"),l=[];p.each(n.children("li"),function(e,t){var n=p(t),i=n.data("field"),o=n.attr("id"),r=d.generatedContentFields[o];if(r){var s=r.getData();s.field=i,s.settings=Ext.decode(n.data("settings"))||{},l.push(s)}}),r.content[i]=l}),c.push(r)}),{child_layouts:c}}};return e}}(vcJquery,ContentBlocks);
//# sourceMappingURL=all-min.js.map